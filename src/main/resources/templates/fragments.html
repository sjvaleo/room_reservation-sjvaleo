<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head></head>
<body>
  <th:block th:fragment="appHeader">
    <header class="page-header" style="position:relative;display:flex;align-items:center;gap:12px;">
      <button class="hamburger" id="menuBtn" aria-label="Menu"
              style="font-size:22px;line-height:1;background:#0f172a;border:1px solid #374151;border-radius:10px;padding:6px 10px;cursor:pointer;color:#e5e7eb;">
        â˜°
      </button>

      <div id="menuPanel"
           style="position:absolute;top:56px;left:12px;display:none;z-index:1000;
                  background:#111827;border:1px solid #374151;border-radius:12px;min-width:220px;
                  box-shadow:0 10px 30px rgba(0,0,0,.55);padding:8px;">
        <!-- Navigation -->
        <a th:href="@{/search}" style="display:block;padding:10px 12px;border-radius:10px;text-decoration:none;color:#e5e7eb;font-weight:600;">
          Search
        </a>
        <a th:href="@{/floors}" style="display:block;padding:10px 12px;border-radius:10px;text-decoration:none;color:#e5e7eb;font-weight:600;">
          Browse Floors
        </a>
        <a th:href="@{/bookings}" style="display:block;padding:10px 12px;border-radius:10px;text-decoration:none;color:#e5e7eb;font-weight:600;">
          My Bookings
        </a>

        <div style="height:1px;background:#374151;margin:8px 6px;"></div>

        <!-- Auth controls (from @ControllerAdvice: loggedIn, username) -->
        <form th:if="${loggedIn}"
              th:action="@{/logout}" method="post" style="margin:0;">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          <button type="submit"
                  style="width:100%;padding:10px 12px;border-radius:10px;border:1px solid #374151;background:#0b1020;color:#e5e7eb;cursor:pointer;font-weight:600;">
            Log out
          </button>
        </form>

        <a th:if="${!loggedIn}"
           th:href="@{/login}"
           style="display:block;padding:10px 12px;border-radius:10px;text-decoration:none;color:#e5e7eb;font-weight:600;">
          Log in
        </a>
      </div>

      <h1 class="brand" style="margin-left:auto;">
        <a th:href="@{/}" style="text-decoration:none;color:inherit;">Room Reservation</a>
      </h1>
    </header>

    <script>
      (function(){
        const btn = document.getElementById('menuBtn');
        const panel = document.getElementById('menuPanel');
        if (!btn || !panel) return;

        function hoverize(el){
          el.addEventListener('mouseenter', () => { el.style.background = '#1f2937'; });
          el.addEventListener('mouseleave', () => { el.style.background = 'transparent'; });
        }
        panel.querySelectorAll('a').forEach(hoverize);

        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          panel.style.display = (panel.style.display === 'block') ? 'none' : 'block';
        });
        document.addEventListener('click', (e) => {
          if (panel.style.display === 'block' && !panel.contains(e.target) && e.target !== btn) {
            panel.style.display = 'none';
          }
        });
      })();
    </script>
  </th:block>

  <!-- legacy no-op -->
  <th:block th:fragment="site_header"></th:block>
</body>
</html>
